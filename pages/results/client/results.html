<template name="results">
<div class="container">
<div class="container" id="resultsTop" style="height:25%;">
<div class="row">
  <div class="col-sm-6" id="numReturned"></div>
  <div class="col-sm-6" align="right" id="audioButton">
  <input id="input" type="text" hidden>
  <button class="btn btn-default btn-circle btn-large" id="rec">
    <i class="fa fa-microphone "></i>

  </button>
</div>
</div>
<br>

<br>
</div>
<br><br><br><br><br><br>
  <div class ="row">
    <div class="col-sm-6">
      <div class = "table-responsive" >
        <br>
        <table class="table table-bordered table-condensed table-hover" style="font-size:20px">

          <thead class="text-center">
            <tr>
              <td><strong>Name</strong></td>
              <td><strong>Distance (miles)</strong></td>
              <td><strong>Favorite</strong></td>
            </tr>
          </thead>
            <br>
          <tbody data-link='row' class='rowlink' id="results">
          </tbody>
          </table>
      </div>
    </div>
    <br><br><br><br>
  <div id="mapWrapper" class="container">
    <div data-spy="affix"
     class="col-sm-6" id="map" style="border: 3px solid black"></div>
  </div>
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAy2p_5PUZON-7hFdoUHtqbfyLNQZNfIu4&callback=initMap">
      console.log("defering");
    </script>
</div>
<div id="urlImport" hidden></div>
</div>


<div class="modal fade" id="docModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <div class="row" id="docModalName">
        </div>
        <div class="row" id="specInfo">
        </div>
      </div>
      <div class="modal-body">
        <div class="container">
          <div class="row">
            <div class="col-xs-2" id="profImage">
            </div>
            <div class="col-xs-4" id="docBio">
            </div>
          </div>
        </div>
          <hr>
          <div class="container">
        <div class="row">
            <div class="col-xs-2" id="langSpoken">
            </div>
            <div class="col-xs-4" id="docLicenses">
            </div>
          </div>
        </div>
        <hr>
        <div class="container">
        <div class="row">
          <div class="col-xs-3" id="docAddresses">
          </div>
          <div class="col-xs-3" id="docInsurances">
          </div>
        </div>
    </div>
    <hr>
    <div class="container">
      <div class="row">
        <div class="col-xs-6 center" id="docPayments">
          <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
          <canvas id="myChart"></canvas>
        </div>
      </div>
    </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">


  document.getElementById("rec").style.backgroundColor = "#1985A1";
  var latitude;
  var longitude;
  var accessToken = "f984d307361f4004ac180e3aeb02dd7d";
  var baseUrl = "https://api.api.ai/v1/";
  $(document).ready(function() {
    $("#rec").click(function(event) {
      switchRecognition();
    });
  });
  var recognition;
  function startRecognition() {
    recognition = new webkitSpeechRecognition();
    recognition.onstart = function(event) {
      updateRec();
    };
    recognition.onresult = function(event) {
      var text = "";
        for (var i = event.resultIndex; i < event.results.length; ++i) {
          text += event.results[i][0].transcript;
        }
        setInput(text);
      stopRecognition();
    };
    recognition.onend = function() {
      stopRecognition();
    };
    recognition.lang = "en-US";
    recognition.start();
  }

  function stopRecognition() {
    if (recognition) {
      recognition.stop();
      recognition = null;
    }
    updateRec();
  }
  function switchRecognition() {
    if (recognition) {
      stopRecognition();
    } else {
      startRecognition();
    }
  }
  function setInput(text) {
    $("#input").val(text);
    send();
  }
  function updateRec() {
    $("#rec").backgroundColor(recognition ? colorchange() : changecolor() );
  }
  function colorchange() {
    document.getElementById("rec").style.backgroundColor = "#fc6f6f";
  }
  function changecolor() {
    document.getElementById("rec").style.backgroundColor = "#1985A1";
  }
  function send() {
    var text = $("#input").val();
    $.ajax({
      type: "POST",
      url: baseUrl + "query?v=20150910",
      contentType: "application/json; charset=utf-8",
      dataType: "json",
      headers: {
        "Authorization": "Bearer " + accessToken
      },
      data: JSON.stringify({ query: text, lang: "en", sessionId: "somerandomthing" }),
      success: function(data) {
        setResponse(JSON.stringify(data, undefined, 2));
        console.log(data);
        responsiveVoice.speak("," + data.result.fulfillment.speech);
        if (data.result.metadata.intentName === 'Next'){
          var url = document.getElementById("urlImport").innerHTML;
          var spliturl = url.split('&skip=');
          console.log(spliturl);
          url.replace("")
        }else if (data.result.metadata.intentName === 'Home'){
          Router.go('home');
        }
      },
      error: function() {
        setResponse("Internal Server Error");
      }
    });
    setResponse("Loading...");
  }
  function setResponse(val) {
    $("#response").text(val);
  }
</script>

</template>
